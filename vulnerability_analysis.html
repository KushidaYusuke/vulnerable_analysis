<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Web&#x30a2;&#x30d7;&#x30ea;&#x30b1;&#x30fc;&#x30b7;&#x30e7;&#x30f3;&#x8a3a;&#x65ad;&#x5831;&#x544a;&#x66f8;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="webアプリケーション診断報告書">Webアプリケーション診断報告書</h1>
<ul>
<li><a href="#web%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E8%A8%BA%E6%96%AD%E5%A0%B1%E5%91%8A%E6%9B%B8">Webアプリケーション診断報告書</a>
<ul>
<li><a href="#%E8%A8%BA%E6%96%AD%E5%86%85%E5%AE%B9">診断内容</a>
<ul>
<li><a href="#%E8%A8%BA%E6%96%AD%E7%92%B0%E5%A2%83">診断環境</a></li>
<li><a href="#%E5%AF%BE%E8%B1%A1%E3%82%B5%E3%82%A4%E3%83%88">対象サイト</a></li>
</ul>
</li>
<li><a href="#%E8%A8%BA%E6%96%AD%E7%B5%90%E6%9E%9C%E6%A6%82%E8%A6%81">診断結果概要</a></li>
<li><a href="#%E9%9D%9E%E5%B8%B8%E3%81%AB%E5%8D%B1%E9%99%BA%E3%81%AA%E7%8A%B6%E6%85%8B">非常に危険な状態</a></li>
<li><a href="#%E8%A8%BA%E6%96%AD%E7%B5%90%E6%9E%9C%E8%A9%B3%E7%B4%B0">診断結果詳細</a>
<ul>
<li><a href="#sql%E3%82%A4%E3%83%B3%E3%82%B8%E3%82%A7%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3cwe-89">SQLインジェクション(CWE-89)</a></li>
<li><a href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%A4%E3%83%B3%E3%82%B8%E3%82%A7%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3cwe-78">コマンドインジェクション(CWE-78)</a></li>
<li><a href="#%E3%83%91%E3%82%B9%E3%83%88%E3%83%A9%E3%83%90%E3%83%BC%E3%82%B5%E3%83%ABcwe-22">パストラバーサル(CWE-22)</a></li>
<li><a href="#%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B8%E3%83%A3%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0">クリックジャッキング</a></li>
<li><a href="#%E8%AA%8D%E8%A8%BC">認証</a>
<ul>
<li><a href="#%E3%83%AD%E3%82%B0%E3%82%A2%E3%82%A6%E3%83%88%E6%A9%9F%E8%83%BD%E3%81%AE%E4%B8%8D%E5%82%99%E3%82%84%E6%9C%AA%E5%AE%9F%E8%A3%85">ログアウト機能の不備や未実装</a></li>
<li><a href="#%E9%81%8E%E5%BA%A6%E3%81%AA%E8%AA%8D%E8%A8%BC%E8%A9%A6%E8%A1%8C%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%AF%BE%E7%AD%96%E4%B8%8D%E5%82%99%E3%82%84%E6%9C%AA%E5%AE%9F%E8%A3%85cwe-307">過度な認証試行に対する対策不備や未実装(CWE-307)</a></li>
<li><a href="#%E8%84%86%E5%BC%B1%E3%81%AA%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BCcwe-521">脆弱なパスワードポリシー(CWE-521)</a></li>
<li><a href="#%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%83%AA%E3%82%BB%E3%83%83%E3%83%88%E3%81%AE%E4%B8%8D%E5%82%99cwe-640">パスワードリセットの不備(CWE-640)</a></li>
</ul>
</li>
<li><a href="#%E8%AA%8D%E5%8F%AF%E5%88%B6%E5%BE%A1%E3%81%AE%E4%B8%8D%E5%82%99cwe-264">認可制御の不備(CWE-264)</a></li>
<li><a href="#%E3%82%AF%E3%83%AD%E3%82%B9%E3%82%B5%E3%82%A4%E3%83%88%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%AAcwe-352">クロスサイトリクエストフォージェリ(CWE-352)</a></li>
<li><a href="#%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%81%AE%E4%B8%8D%E5%82%99">セッション管理の不備</a>
<ul>
<li><a href="#cookie%E3%81%AEhttponly%E5%B1%9E%E6%80%A7%E6%9C%AA%E8%A8%AD%E5%AE%9Acwe-1004">CookieのHttpOnly属性未設定(CWE-1004)</a></li>
<li><a href="#%E6%8E%A8%E6%B8%AC%E5%8F%AF%E8%83%BD%E3%81%AA%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3id">推測可能なセッションID</a></li>
</ul>
</li>
<li><a href="#%E6%83%85%E5%A0%B1%E6%BC%8F%E6%B4%A9">情報漏洩</a>
<ul>
<li><a href="#%E7%94%BB%E9%9D%A2%E8%A1%A8%E7%A4%BA%E4%B8%8A%E3%81%AE%E3%83%9E%E3%82%B9%E3%82%AF%E4%B8%8D%E5%82%99">画面表示上のマスク不備</a></li>
<li><a href="#%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%81%AE%E3%83%9E%E3%82%B9%E3%82%AF%E4%B8%8D%E5%82%99cwe-549">パスワードフィールドのマスク不備(CWE-549)</a></li>
<li><a href="#https%E5%88%A9%E7%94%A8%E6%99%82%E3%81%AEcookie%E3%81%AEsecure%E5%B1%9E%E6%80%A7%E6%9C%AA%E8%A8%AD%E5%AE%9Acwe-614">HTTPS利用時のCookieのSecure属性未設定(CWE-614)</a></li>
<li><a href="#https%E3%81%AE%E4%B8%8D%E5%82%99">HTTPSの不備</a></li>
<li><a href="#%E4%B8%8D%E8%A6%81%E3%81%AA%E6%83%85%E5%A0%B1%E3%81%AE%E5%AD%98%E5%9C%A8cwe-209">不要な情報の存在(CWE-209)</a></li>
<li><a href="#%E5%85%AC%E9%96%8B%E4%B8%8D%E8%A6%81%E3%81%AA%E6%A9%9F%E8%83%BD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E5%AD%98%E5%9C%A8">公開不要な機能、ファイル、ディレクトリの存在</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E4%BB%98%E9%8C%B2">付録</a>
<ul>
<li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">参考文献</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="診断内容">診断内容</h2>
<h3 id="診断環境">診断環境</h3>
<p>OS:  Linux2.4.xカーネル
ブラウザ:  FireFox
診断ツール:  BurpSuite</p>
<h3 id="対象サイト">対象サイト</h3>
<p><a href="http://www.badstore.net/">http://www.badstore.net/</a></p>
<h2 id="診断結果概要">診断結果概要</h2>
<h2 id="非常に危険な状態">非常に危険な状態</h2>
<p>今回の診断の結果、SQLインジェクションやOSコマンドインジェクションによって、攻撃者がWebサーバーに対して直接攻撃することのできる非常に危険度の高い脆弱性が複数個発見された。
これらの脆弱性を悪用された場合、重要なファイルや、データベースに保存されている個人情報の漏えい、改ざんなどの被害が発生する可能性がある。
また、パスワードポリシーが設定されていない、容易に一般利用者の権限を書き換えることができるといった、認証、認可に関する問題も複数個発見された。</p>
<h2 id="診断結果詳細">診断結果詳細</h2>
<h3 id="sqlインジェクションcwe-89">SQLインジェクション(CWE-89)</h3>
<p>1.リスク評価　高
2.発見箇所</p>
<table>
<thead>
<tr>
<th>No.</th>
<th>URL</th>
<th>パラメータ名</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><a href="http://www.badstore.net/cgi-bin/badstore.cgi">http://www.badstore.net/cgi-bin/badstore.cgi</a></td>
<td>searchquery</td>
</tr>
<tr>
<td>2</td>
<td><a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister">https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister</a></td>
<td>email</td>
</tr>
<tr>
<td>3</td>
<td><a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierportal">https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierportal</a></td>
<td>email</td>
</tr>
</tbody>
</table>
<p>No.1: 商品の検索
<img src="file:////home/yusuke/record/image-7.png" alt="alt text"></p>
<p>No.2: ログイン画面
<img src="file:////home/yusuke/record/image-47.png" alt="alt text"></p>
<p>No.3 業者用のログイン画面
<img src="file:////home/yusuke/record/image-48.png" alt="alt text"></p>
<p>3.脆弱性発生状況</p>
<p>No.1の場合について説明する。
パラメータsearchqueryに対して、「searchquery=1000'」と入力した結果、DB関係のSQL Syntax errorが表示されたため、SQLインジェクションがあると判断した。</p>
<ul>
<li>HTTPリクエストメッセージ</li>
</ul>
<p><img src="file:////home/yusuke/record/image-8.png" alt="alt text"></p>
<ul>
<li>HTTPレスポンスメッセージ</li>
</ul>
<p><img src="file:////home/yusuke/record/image-9.png" alt="alt text"></p>
<ul>
<li>表示されるエラーメッセージ</li>
</ul>
<p><img src="file:////home/yusuke/record/image-10.png" alt="alt text"></p>
<p>4.想定される脅威
データベースに保存されている情報の漏洩、改ざん、消去や認証回避による不正ログインの恐れがある。</p>
<p>5.対応策
SQLの組み立てにプレースホルダーを用いて、バインド処理により値を割り当てる処理を推奨する。</p>
<h3 id="コマンドインジェクションcwe-78">コマンドインジェクション(CWE-78)</h3>
<p>1.リスク評価 高</p>
<p>2.発見箇所</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>パラメータ</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierportal">https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierportal</a></td>
<td>viewfilename</td>
</tr>
</tbody>
</table>
<p>業者向けページのbadsite内価格ファイルの閲覧画面
<img src="file:////home/yusuke/record/image-12.png" alt="alt text"></p>
<p>3.脆弱性発生状況</p>
<p>パラメーター「viewfilename」に<code>../../../../../../../bin/sleep 20|</code>と入力して「Go」ボタンで実行した際にレスポンスが20秒遅れて返ってくる。</p>
<p><img src="file:////home/yusuke/record/image-13.png" alt="alt text"></p>
<p><img src="file:////home/yusuke/record/image-14.png" alt="alt text"></p>
<p>4.想定される脅威
サーバ内ファイルの閲覧、改ざん、削除や不正なシステム操作をされる恐れがある。</p>
<p>5.対応策
設計段階でOSコマンド呼び出しを使わない実装方法を選択する、シェル呼び出し機能のある関数の利用を避けるといった対策がある。
シェルを起動できる言語機能を利用する場合には、保険的な対策として、引数を構成する全ての変数に対してチェックを行い、あらかじめ許可した処理のみを実行するようにする。</p>
<p>###　クロスサイト・スクリプティング(CWE-79)
1.リスク評価 中
2.発見箇所</p>
<table>
<thead>
<tr>
<th>No.</th>
<th>URL</th>
<th>パラメータ名</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><a href="https://www.badstore.net/cgi-bin/badstore.cgi">https://www.badstore.net/cgi-bin/badstore.cgi</a></td>
<td>searchquery</td>
</tr>
<tr>
<td>2</td>
<td><a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=myaccount">https://www.badstore.net/cgi-bin/badstore.cgi?action=myaccount</a></td>
<td>fullname</td>
</tr>
<tr>
<td>3</td>
<td><a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=guestbook">https://www.badstore.net/cgi-bin/badstore.cgi?action=guestbook</a></td>
<td>name</td>
</tr>
</tbody>
</table>
<p>No.1 商品の検索
<img src="file:////home/yusuke/record/image-7.png" alt="alt text"></p>
<p>No.2 アカウント情報の更新画面
<img src="file:////home/yusuke/record/image-52.png" alt="alt text"></p>
<p>No.3 フォーム送信画面
<img src="file:////home/yusuke/record/image-53.png" alt="alt text"></p>
<p>3.脆弱性発生状況</p>
<p>No.1の場合について説明する。
パラメータ「search_query」に<code>1000&lt;script&gt;alert(1)&lt;/script&gt;</code>と入力した際にエスケープされずに入力したスクリプトが作動した。</p>
<p>作動したスクリプト
<img src="file:////home/yusuke/record/image-54.png" alt="alt text"></p>
<ul>
<li>
<p>HTTPリスエストメッセージ
<img src="file:////home/yusuke/record/image-15.png" alt="alt text"></p>
</li>
<li>
<p>HTTPレスポンスメッセージ(一部)
<img src="file:////home/yusuke/record/image-16.png" alt="alt text"></p>
</li>
</ul>
<p>4.想定される脅威
本サイト上に偽のページが表示される、ブラウザが保存しているCookieを取得される等の可能性がある。</p>
<p>5.対応策
ウェブページに出力するするすべての要素に対して、エスケープ処理を施す。
URLを出力する際にはhttp, httpsで始まるURLのみを許可する、<code>&lt;script&gt;...&lt;/script&gt;</code>要素の内容を動的に生成しない等の対策をとる必要がある。</p>
<p>参考情報:</p>
<ul>
<li>エスケープ処理の実装例</li>
</ul>
<pre><code>&lt;?php
// エスケープ処理関数
function escape_html($input) {
    return htmlspecialchars($input, ENT_QUOTES, 'UTF-8');
}

// エスケープ処理を施した文字列
$unsafe_html = &quot;&lt;script&gt;alert('Hello, world!');&lt;/script&gt;&quot;;
$safe_html = escape_html($unsafe_html);

// 安全に表示される
echo &quot;&lt;div&gt;&quot; . $safe_html . &quot;&lt;/div&gt;&quot;;
?&gt;
</code></pre>
<h3 id="パストラバーサルcwe-22">パストラバーサル(CWE-22)</h3>
<p>1.リスク評価　高
2。発見箇所
<a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierportal">https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierportal</a>
<img src="file:////home/yusuke/record/image-35.png" alt="alt text">
3.脆弱性発生状況
パラメータ「viewfilename」に<code>../../../../../../../../../etc/hosts</code>と入力すると、サーバ内の/etc/hostsファイルが表示されてしまう</p>
<p>4.想定される脅威
hostsファイルの情報が外部に漏洩したり、改ざんや削除をされてしまう可能性がある。</p>
<p>5.対応策
外部からのパラメータでウェブサーバ内のファイル名を直接指定する実装を避ける。
ファイルを開く際は、固定のディレクトリを指定し、かつファイル名にディレクトリ名が含まれないようにする。</p>
<h3 id="クリックジャッキング">クリックジャッキング</h3>
<p>1.リスク評価　中</p>
<p>2.発見箇所　<a href="http://www.badstore.net/cgi-bin/badstore.cgi?action=submitpayment">http://www.badstore.net/cgi-bin/badstore.cgi?action=submitpayment</a>
<img src="file:////home/yusuke/record/image-34.png" alt="alt text"></p>
<p>3.脆弱性発生状況
決済の確定処理の直前画面において、レスポンスヘッダにX-Frame-Optionsヘッダフィールドが存在しない。</p>
<p>4.想定される脅威
クリックジャッキング攻撃により、クレジットカードの番号を盗み取られる危険性がある。</p>
<p>5.対応策
レスポンスヘッダにX-Frame-Optionsヘッダを出力するよう設定を行う。
X-Frame-Optionsヘッダフィールドは、コンテンツがiframeタグなどで他のサイトに埋め込まれないことを保証しており、
クリックジャッキング攻撃を防いでいる。</p>
<p>参考情報
PHPの場合のX-Frame-OptionsでSAMEIRIGIN(同一オリジンの場合のみiframeで表示)を設定する記述
<code>header('X-Frame-Options: SAMEORIGIN');</code></p>
<h3 id="認証">認証</h3>
<h4 id="ログアウト機能の不備や未実装">ログアウト機能の不備や未実装</h4>
<p>1.リスク評価　中</p>
<p>2.発見箇所
すべてのページ</p>
<p>3.脆弱性発生状況
ログアウト機能が存在せず、手動で消去しない限りcookieが残る。</p>
<p>4.想定される脅威
共有PCを使っている場合や離席中のパソコンを勝手に使用される場合に、ログインしたままのアプリケーションがあれば、勝手に使われてなりすましをされてしまう恐れがある。</p>
<p>5.対応策
セッションタイムアウト時間を短くする。ログアウト機能の実装をする。</p>
<h4 id="過度な認証試行に対する対策不備や未実装cwe-307">過度な認証試行に対する対策不備や未実装(CWE-307)</h4>
<p>1.リスク評価　中</p>
<p>2.発見箇所
<a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister">https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister</a>
<img src="file:////home/yusuke/record/image-36.png" alt="alt text"></p>
<p>3.脆弱性発生状況
同じユーザー名でパスワードを連続で10回間違った場合でも、アカウントがロックされない。</p>
<!-- (4, 5 徳丸本参考) -->
<p>4.想定される脅威
ブルートフォース攻撃や辞書攻撃によって、繰り返し試行を行うことで不正なログインが行われてしまう。</p>
<p>5.対応策
10回を目安に、パスワードを連続して間違えた場合にはアカウントをロックする。
その後は次のようなルールでアカウントの再有効化を行う</p>
<ul>
<li>30分が経過した際に、自動的に再有効化する</li>
<li>何らかの方法で本人確認が行われた後に再有効化する</li>
</ul>
<h4 id="脆弱なパスワードポリシーcwe-521">脆弱なパスワードポリシー(CWE-521)</h4>
<p>1.リスク評価　中</p>
<p>2.発生個所
<a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister">https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister</a>
アカウントの登録画面
<img src="file:////home/yusuke/record/image-37.png" alt="alt text">
3.脆弱性発生状況
パスワードを登録する際に数字のみ(例:0000)のような脆弱なパスワードが登録できてしまう。</p>
<p>4．想定される脅威
パスワードが推測しやすいために、不正にログインされてしまう恐れがある。</p>
<p>5.対応策
パスワードを設定する際に、8桁以上で数値と英小大文字を含むといった、パスワードポリシーを定める。</p>
<h4 id="パスワードリセットの不備cwe-640">パスワードリセットの不備(CWE-640)</h4>
<p>1.リスク評価　中</p>
<p>2.発生個所　
アカウントの再設定画面
<a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=myaccount">https://www.badstore.net/cgi-bin/badstore.cgi?action=myaccount</a>
<img src="file:////home/yusuke/record/image-46.png" alt="alt text">
<img src="file:////home/yusuke/record/image-45.png" alt="alt text"></p>
<p>3.脆弱性発生状況
パスワードリセットの際に、ユーザー本人のみが受け取れる連絡先に再設定方法が通知されるのではなく、画面上にWelcomeという再設定されたパスワードが表示され、そのままこのパスワードを利用することができる。
なお、パスワードの変更の際には、毎回、新しいパスワードとして「Welcome」という文字列が表示される。</p>
<p>4．想定される脅威
新しく発行されたパスワード「Welcome」をそのままユーザーが使用し続けた場合、攻撃者は容易にパスワードを推測できてしまう。</p>
<p>5.対応策
パスワードの変更のみができる仮パスワードをメールで利用者に送信する運用にする。</p>
<h3 id="認可制御の不備cwe-264">認可制御の不備(CWE-264)</h3>
<p>1.リスク評価　高
2.発見箇所</p>
<table>
<thead>
<tr>
<th>No</th>
<th>URL</th>
<th>パラメータ</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister">https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister</a></td>
<td>role</td>
</tr>
<tr>
<td>2</td>
<td><a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierportal">https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierportal</a></td>
<td>action</td>
</tr>
<tr>
<td>3</td>
<td><a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=admin">https://www.badstore.net/cgi-bin/badstore.cgi?action=admin</a></td>
<td>action</td>
</tr>
</tbody>
</table>
<p><img src="file:////home/yusuke/record/image-19.png" alt="alt text">
<em>アカウントの登録画面(No.1)</em></p>
<p><img src="file:////home/yusuke/record/image-38.png" alt="alt text">
<em>Supplier, Admin権限が必要な画面(No.2)</em></p>
<p><img src="file:////home/yusuke/record/image-49.png" alt="alt text">
<em>Admin権限が必要な画面(No.3)</em></p>
<p>3.脆弱性発生状況</p>
<p>NO.1の場合
新しいユーザーを作成する際に、権限を示すパラメーター「role」をUからA, Sに書き換えることで、一般ユーザーに対して、サプライヤー権限や管理者権限を付与することができる。その結果、一般ユーザーではアクセスすることのできない情報や機能が閲覧、操作できてしまう。</p>
<p><img src="file:////home/yusuke/record/image-20.png" alt="alt text">
<em>roleをUからAに書き換え</em></p>
<p>No.2, No.3の場合
サプライヤー権限,admin権限が必要なページに対して、そのページのURLを指定することで、認証していない状態でアクセスできてしまう</p>
<p>4.想定される脅威
一般ユーザーが本来閲覧することのできないページを閲覧、編集することで、重要なデータの漏洩、改ざんの恐れがある。</p>
<p>5.対応策
権限の情報をセッション変数に保持することで書き換えを防ぐとともに、処理や表示の直前に権限の確認をするようにする。</p>
<h3 id="クロスサイトリクエストフォージェリcwe-352">クロスサイトリクエストフォージェリ(CWE-352)</h3>
<p>1.リスク評価　中</p>
<p>2.発見箇所
<a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=myaccount">https://www.badstore.net/cgi-bin/badstore.cgi?action=myaccount</a>
<img src="file:////home/yusuke/record/image-21.png" alt="alt text"></p>
<p>3.脆弱性発生状況
ログイン中にアカウント情報を更新する際に
リクエストヘッダに以下の情報が含まれておらず、</p>
<pre><code>A: 利用者のパスワード
B: CSRF対策トークン
C: セッションID
D: CAPTCHA
</code></pre>
<p>かつ、Refererヘッダを変更しても更新処理ができてしまう。</p>
<p><img src="file:////home/yusuke/record/image-24.png" alt="alt text">
<em>元のHTTPリクエストヘッダ</em></p>
<p><img src="file:////home/yusuke/record/image-25.png" alt="alt text">
<em>Refererヘッダを削除</em></p>
<p><img src="file:////home/yusuke/record/image-26.png" alt="alt text">\
<em>更新できてしまう</em></p>
<p>4.想定される脅威
ログイン後の利用者のみが利用可能なサービスや編集可能な情報が悪用される恐れがある。</p>
<p>5.対応策
Refererヘッダがない場合や適切なURLが指定されていない場合はエラーを返すという方式にすることでCSRF攻撃を対策することができるが、
より確実な対策として、登録画面や決済画面ではトークンを埋め込む、パスワードを再入力させるという対策がある。</p>
<h3 id="セッション管理の不備">セッション管理の不備</h3>
<h4 id="cookieのhttponly属性未設定cwe-1004">CookieのHttpOnly属性未設定(CWE-1004)</h4>
<p>1.リスク評価　中
2.発見箇所
<a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister">https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister</a>
<img src="file:////home/yusuke/record/image-27.png" alt="alt text"></p>
<p>3.脆弱性発生状況
ログイン時のレスポンスヘッダにあるSet-CookieヘッダーフィールドにHttpOnly属性が付与されていない
<img src="file:////home/yusuke/record/image-39.png" alt="alt text"></p>
<p>4.想定される脅威
Javascriptを使用してクッキーの値にアクセスされることで、セッションハイジャック攻撃等のリスクがある。</p>
<p>5.対応策
HttpOnly属性を使用して、Javascriptからのアクセスを防ぐ。</p>
<p>例えば、PHPではphp.iniに以下を設定する</p>
<p><code>session.cookie_httponly = on</code></p>
<h4 id="推測可能なセッションid">推測可能なセッションID</h4>
<p>1.リスク評価　中</p>
<p>2.発見箇所
<a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister">https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister</a>
<img src="file:////home/yusuke/record/image-27.png" alt="alt text"></p>
<p>3.脆弱性発生状況</p>
<p>ログイン時に発行されるセッションIDが、各ユーザーに対して固定されている。
また、セッションIDをエンコードした結果、次の法則をもとにセッションIDが生成されていることが分かった。</p>
<pre><code>(ユーザーのセッションID) = [Email Adress]:[Password]のMD5:[Fullname] : role
</code></pre>
<p>上から順に、元のセッションID, セッションIDをURLでデコードした結果、さらにBASE64でデコードした結果。
<img src="file:////home/yusuke/record/image-58.png" alt="alt text"></p>
<p>さらに、メールアドレスとユーザー名の間の32文字の英小文字を<a href="https://10015.io/tools/md5-encrypt-decrypt">MD5 Decrypt</a>でデコードした結果
パスワード「1028」が表示される
<img src="file:////home/yusuke/record/image-59.png" alt="alt text">
4.想定される脅威</p>
<p>セッションIDが推測できることで、セッションハイジャックが可能になる。</p>
<p>5.対応策
セッションIDを生成する際には、自作のセッション管理機構を自作するのではなく、アプリケーション開発ツールが備えているセッション管理機構を使用する。</p>
<h3 id="情報漏洩">情報漏洩</h3>
<h4 id="画面表示上のマスク不備">画面表示上のマスク不備</h4>
<p>1.リスク評価 弱
2.発見箇所
<a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=submitpayment">https://www.badstore.net/cgi-bin/badstore.cgi?action=submitpayment</a>
<a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=viewprevious">https://www.badstore.net/cgi-bin/badstore.cgi?action=viewprevious</a></p>
<p>No.1 商品の決済画面
<img src="file:////home/yusuke/record/image-51.png" alt="alt text">
No.2 購入履歴の画面
<img src="file:////home/yusuke/record/image-50.png" alt="alt text">
3.脆弱性発生状況
クレジットカードのキャッシュ番号がマスクされていない</p>
<h4 id="パスワードフィールドのマスク不備cwe-549">パスワードフィールドのマスク不備(CWE-549)</h4>
<p>1.リスク評価　弱
2.発見箇所
<a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister">https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister</a>
ログイン画面
<img src="file:////home/yusuke/record/image-40.png" alt="alt text">
3.脆弱性発生状況
ログイン画面でのパスワードの入力がマスクされていない</p>
<p>(4,5 徳丸本p.487参照)
4.想定される脅威
ショルダーハックにより、入力中にパスワードを盗み見されるリスクがある。
5.対応策
type属性がpasswordのinput属性を使い、入力されたパスワードが画面上に表示されないようにする。</p>
<h4 id="https利用時のcookieのsecure属性未設定cwe-614">HTTPS利用時のCookieのSecure属性未設定(CWE-614)</h4>
<p>1.リスク評価　
2.発見箇所
<a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister">https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister</a>
ログイン、登録画面
<img src="file:////home/yusuke/record/image-42.png" alt="alt text">
3.脆弱性発生状況
Httpsの利用時にCookieのSecure属性(SSL/TLSを併用したHTTPS通信でしかCookieのやり取りをしないようにする設定)が設定されていない</p>
<ul>
<li>登録、ログイン時にサーバによって発行されるCookie
<img src="file:////home/yusuke/record/image-31.png" alt="alt text"></li>
</ul>
<p>4.想定される脅威
アプリケーションがHTTPSを使用していても、Secure属性がついていないCookieは平文で送られてしまう場合があり、盗聴される可能性がある。</p>
<p>5.対応策
CookieにSecure属性を設定する。
例えば、PHPの場合はphp.iniに次のように設定することで、CookieにSecure属性をつけることができる</p>
<p><code>session.cookie_secure = on</code></p>
<h4 id="httpsの不備">HTTPSの不備</h4>
<p>1.リスク評価　中</p>
<p>2.発生個所</p>
<p><a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister">https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister</a>
<a href="https://www.badstore.net/cgi-bin/badstore.cgi?action=submitpayment">https://www.badstore.net/cgi-bin/badstore.cgi?action=submitpayment</a></p>
<p><img src="file:////home/yusuke/record/image-57.png" alt="alt text">
<img src="file:////home/yusuke/record/image-56.png" alt="alt text"></p>
<p>3.脆弱性発生状況</p>
<p>決済画面やログイン画面において、URLをhttpsからhttpに書き換えることで、HTTPSでなくHTTPでの通信ができてしまう。</p>
<p>4.想定される脅威
攻撃者によってURLが改ざんされることで、HTTPSではなくHTTPで通信をすることで、クレジットカードの番号やパスワードが攻撃者に奪われてしまう。</p>
<p>5.対応策</p>
<p>301転送により、HTTPのページにアクセスがあった場合はHTTPSのページにリダイレクトするようにする</p>
<p>参考情報</p>
<p>Apacheサーバの.htaccessファイルに以下の記述を追加することで301転送の設定ができる。
<a href="https://www.idcf.jp/rentalserver/aossl/operation/unify-access/">https://www.idcf.jp/rentalserver/aossl/operation/unify-access/</a></p>
<pre><code>Options +FollowSymLinks
RewriteEngine on
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://(ドメイン名)/$1 [R=301,L]
</code></pre>
<h4 id="不要な情報の存在cwe-209">不要な情報の存在(CWE-209)</h4>
<p>1.リスク評価 弱</p>
<p>2.発見箇所
<a href="http://www.badstore.net/cgi-bin/badstore.cgi">http://www.badstore.net/cgi-bin/badstore.cgi</a>
<img src="file:////home/yusuke/record/image-43.png" alt="alt text"></p>
<p><a href="http://www.badstore.net/cgi-bin/badstore.cgi?action=cartadd">http://www.badstore.net/cgi-bin/badstore.cgi?action=cartadd</a>
<img src="file:////home/yusuke/record/image-44.png" alt="alt text"></p>
<p>3.脆弱性発生状況
searchqueyパラメータに、データベースのItemNum欄に存在しない番号(例えば-1)を入力すると次のようなエラーメッセージが画面上に出力される</p>
<ul>
<li>No.2の場合
以下の画像のように、一つもカートに入っていない状態で注文ボタン(Place Order)を押すと、
ipアドレスが公開されたページへ飛んでしまう</li>
</ul>
<p><img src="file:////home/yusuke/record/image-33.png" alt="alt text"></p>
<p>(4, 5参考 <a href="https://softwarenote.info/p3207/">https://softwarenote.info/p3207/</a>)
4.想定される脅威
エラーメッセージから、検索に使用しているSQL文が判明してしまう。それによって、SQLインジェクションなどのセキュリティのリスクがある。</p>
<p>5.対応策
利用者に見せるエラーメッセージと開発者が見るデバッグ情報を明確に区別する</p>
<p>例えば、PHPではphp.iniで次のような設定をする</p>
<pre><code>display_errors = Off # エラーの画面出力
log_errors = On # エラーのログ出力
</code></pre>
<h4 id="公開不要な機能ファイルディレクトリの存在">公開不要な機能、ファイル、ディレクトリの存在</h4>
<p>1.リスク評価　弱
23.発生個所 <a href="http://www.badstore.net/ws/">http://www.badstore.net/ws/</a></p>
<p>3.脆弱性発生状況</p>
<p>ホーム画面のこちらのリンクから
<img src="file:////home/yusuke/record/image-30.png" alt="alt text"></p>
<p><a href="http://www.badstore.net/ws/">http://www.badstore.net/ws/</a> に飛ぶと、
PerlやJavaのコードを見ることができてしまう。</p>
<!-- 一部のファイルは
```
print "\nNotice:  Usage of this client is deprecated and will be removed from the server in the next year.  Our security team wants everyone to connect to the service through the WSDL and not directly anymore.\n\n";
```
とあるように、来年には削除予定のファイルが閲覧できてしまう。 -->
<p>4.想定される脅威
悪意のある第三者によって、ファイルが書き換えられてしまうといったリスクがある。</p>
<p>5.対応策
公開するべきファイルとそうでないファイルを精査して、公開するべきでないファイルは非公開にする。</p>
<h2 id="付録">付録</h2>
<h3 id="参考文献">参考文献</h3>
<p>情報処理推進機構　安全なウェブサイトの作り方
<a href="https://www.ipa.go.jp/security/vuln/websecurity/about.html">https://www.ipa.go.jp/security/vuln/websecurity/about.html</a></p>
<p>情報処理推進機構　ウェブ健康診断仕様
<a href="https://www.ipa.go.jp/security/vuln/websecurity/ug65p900000196e2-att/000017319.pdf">https://www.ipa.go.jp/security/vuln/websecurity/ug65p900000196e2-att/000017319.pdf</a></p>
<p>SecuAlive CWE 一覧
<a href="https://secualive.jp/feed/cwe/list/">https://secualive.jp/feed/cwe/list/</a></p>
<p>徳丸 浩　安全なWebアプリケーションの作り方 第2版</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>