<!DOCTYPE html>
<html>
<head>
<title>vulnerability_analysis.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="web%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E8%A8%BA%E6%96%AD%E5%A0%B1%E5%91%8A%E6%9B%B8">Webアプリケーション診断報告書</h1>
<ul>
<li><a href="#web%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E8%A8%BA%E6%96%AD%E5%A0%B1%E5%91%8A%E6%9B%B8">Webアプリケーション診断報告書</a>
<ul>
<li><a href="#%E8%A8%BA%E6%96%AD%E5%86%85%E5%AE%B9">診断内容</a>
<ul>
<li><a href="#%E8%A8%BA%E6%96%AD%E7%92%B0%E5%A2%83">診断環境</a></li>
<li><a href="#%E5%AF%BE%E8%B1%A1%E3%82%B5%E3%82%A4%E3%83%88">対象サイト</a></li>
<li><a href="#%E8%A8%BA%E6%96%AD%E5%AF%BE%E8%B1%A1url%E4%B8%80%E8%A6%A7">診断対象URL一覧</a></li>
</ul>
</li>
<li><a href="#%E8%A8%BA%E6%96%AD%E7%B5%90%E6%9E%9C%E6%A6%82%E8%A6%81">診断結果概要</a></li>
<li><a href="#%E9%9D%9E%E5%B8%B8%E3%81%AB%E5%8D%B1%E9%99%BA%E3%81%AA%E7%8A%B6%E6%85%8B%E3%81%A7%E3%81%99">非常に危険な状態です</a></li>
<li><a href="#%E8%A8%BA%E6%96%AD%E7%B5%90%E6%9E%9C%E8%A9%B3%E7%B4%B0">診断結果詳細</a>
<ul>
<li><a href="#sql%E3%82%A4%E3%83%B3%E3%82%B8%E3%82%A7%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3cwe-89">SQLインジェクション(CWE-89)</a></li>
<li><a href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%A4%E3%83%B3%E3%82%B8%E3%82%A7%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3cwe-78">コマンドインジェクション(CWE-78)</a></li>
</ul>
</li>
<li><a href="#%E3%83%91%E3%82%B9%E3%83%88%E3%83%A9%E3%83%90%E3%83%BC%E3%82%B5%E3%83%AB">パストラバーサル</a>
<ul>
<li><a href="#%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B8%E3%83%A3%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0">クリックジャッキング</a></li>
<li><a href="#%E8%AA%8D%E8%A8%BC">認証</a>
<ul>
<li><a href="#%E3%83%AD%E3%82%B0%E3%82%A2%E3%82%A6%E3%83%88%E6%A9%9F%E8%83%BD%E3%81%AE%E4%B8%8D%E5%82%99%E3%82%84%E6%9C%AA%E5%AE%9F%E8%A3%85">ログアウト機能の不備や未実装</a></li>
<li><a href="#%E9%81%8E%E5%BA%A6%E3%81%AA%E8%AA%8D%E8%A8%BC%E8%A9%A6%E8%A1%8C%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%AF%BE%E7%AD%96%E4%B8%8D%E5%82%99%E3%82%84%E6%9C%AA%E5%AE%9F%E8%A3%85">過度な認証試行に対する対策不備や未実装</a></li>
<li><a href="#%E8%84%86%E5%BC%B1%E3%81%AA%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC">脆弱なパスワードポリシー</a></li>
<li><a href="#%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%83%AA%E3%82%BB%E3%83%83%E3%83%88%E3%81%AE%E4%B8%8D%E5%82%99">パスワードリセットの不備</a></li>
</ul>
</li>
<li><a href="#%E8%AA%8D%E5%8F%AF%E5%88%B6%E5%BE%A1%E3%81%AE%E4%B8%8D%E5%82%99cwe-264">認可制御の不備(CWE-264)</a></li>
<li><a href="#%E3%82%AF%E3%83%AD%E3%82%B9%E3%82%B5%E3%82%A4%E3%83%88%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%AA">クロスサイトリクエストフォージェリ</a></li>
</ul>
</li>
<li><a href="#%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%81%AE%E4%B8%8D%E5%82%99">セッション管理の不備</a>
<ul>
<li><a href="#cookie%E3%81%AEhttponly%E5%B1%9E%E6%80%A7%E6%9C%AA%E8%A8%AD%E5%AE%9A">CookieのHttpOnly属性未設定</a></li>
<li><a href="#%E6%8E%A8%E6%B8%AC%E5%8F%AF%E8%83%BD%E3%81%AA%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3id">推測可能なセッションID</a></li>
</ul>
</li>
<li><a href="#%E5%85%AC%E9%96%8B%E4%B8%8D%E8%A6%81%E3%81%AA%E6%A9%9F%E8%83%BD%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E5%AD%98%E5%9C%A8">公開不要な機能、ディレクトリの存在</a></li>
<li><a href="#%E6%83%85%E5%A0%B1%E6%BC%8F%E6%B4%A9">情報漏洩</a>
<ul>
<li><a href="#%E7%94%BB%E9%9D%A2%E8%A1%A8%E7%A4%BA%E4%B8%8A%E3%81%AE%E3%83%9E%E3%82%B9%E3%82%AF%E4%B8%8D%E5%82%99">画面表示上のマスク不備</a></li>
<li><a href="#%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%81%AE%E3%83%9E%E3%82%B9%E3%82%AF%E4%B8%8D%E5%82%99">パスワードフィールドのマスク不備</a></li>
<li><a href="#https%E5%88%A9%E7%94%A8%E6%99%82%E3%81%AEcookie%E3%81%AEsecure%E5%B1%9E%E6%80%A7%E6%9C%AA%E8%A8%AD%E5%AE%9A">HTTPS利用時のCookieのSecure属性未設定</a></li>
<li><a href="#https%E3%81%AE%E4%B8%8D%E5%82%99">HTTPSの不備</a></li>
</ul>
</li>
<li><a href="#%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AB%E3%82%88%E3%82%8B%E6%83%85%E5%A0%B1%E6%BC%8F%E3%81%88%E3%81%84cwe-209">エラーメッセージによる情報漏えい(CWE-209)</a>
<ul>
<li><a href="#%E3%83%A1%E3%83%A2">メモ</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="%E8%A8%BA%E6%96%AD%E5%86%85%E5%AE%B9">診断内容</h2>
<h3 id="%E8%A8%BA%E6%96%AD%E7%92%B0%E5%A2%83">診断環境</h3>
<p>OS:  Linux2.4.xカーネル
ブラウザ:  FireFox
診断ツール:  BurpSuite</p>
<h3 id="%E5%AF%BE%E8%B1%A1%E3%82%B5%E3%82%A4%E3%83%88">対象サイト</h3>
<p>http://www.badstore.net/</p>
<h3 id="%E8%A8%BA%E6%96%AD%E5%AF%BE%E8%B1%A1url%E4%B8%80%E8%A6%A7">診断対象URL一覧</h3>
<ul>
<li>トップページ　http://www.badstore.net/</li>
<li>ログイン/登録画面 http://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister</li>
<li>アカウント情報変更画面 http://www.badstore.net/cgi-bin/badstore.cgi?action=myaccount</li>
<li>about us http://www.badstore.net/cgi-bin/badstore.cgi?action=aboutus</li>
<li>注文確認画面 http://www.badstore.net/cgi-bin/badstore.cgi?action=aboutus</li>
<li>ゲストブック http://www.badstore.net/cgi-bin/badstore.cgi?action=guestbook</li>
<li>新商品一覧画面 http://www.badstore.net/cgi-bin/badstore.cgi?action=whatsnew</li>
<li>Supplier用画面 https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierlogin</li>
<li>検索結果の画面(このURLは1000と入力した場合)https://www.badstore.net/cgi-bin/badstore.cgi?searchquery=1000&amp;action=qsearch&amp;x=0&amp;y=0</li>
<li></li>
</ul>
<h2 id="%E8%A8%BA%E6%96%AD%E7%B5%90%E6%9E%9C%E6%A6%82%E8%A6%81">診断結果概要</h2>
<h2 id="%E9%9D%9E%E5%B8%B8%E3%81%AB%E5%8D%B1%E9%99%BA%E3%81%AA%E7%8A%B6%E6%85%8B%E3%81%A7%E3%81%99">非常に危険な状態です</h2>
<p>今回の診断の結果、SQLインジェクションやOSコマンドインジェクションによって、攻撃者がWebサーバーに対して直接攻撃することのできる非常に危険度の高い脆弱性が複数個見つかった。
これらの脆弱性を悪用された場合、重要なファイルや、データベースに保存されている個人情報の漏えい、改ざんなどの被害が発生する可能性がある。
また、パスワードポリシーが設定されていない、容易に一般利用者の権限を書き換えることができるといった、認証、認可に関する問題も複数個発見された。</p>
<h2 id="%E8%A8%BA%E6%96%AD%E7%B5%90%E6%9E%9C%E8%A9%B3%E7%B4%B0">診断結果詳細</h2>
<h3 id="sql%E3%82%A4%E3%83%B3%E3%82%B8%E3%82%A7%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3cwe-89">SQLインジェクション(CWE-89)</h3>
<p>1.リスク評価　高
2.発見箇所</p>
<table>
<thead>
<tr>
<th>No.</th>
<th>URL</th>
<th>パラメータ名</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>http://www.badstore.net/cgi-bin/badstore.cgi</td>
<td>searchquery</td>
</tr>
<tr>
<td>2</td>
<td>https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister</td>
<td>email</td>
</tr>
<tr>
<td>3</td>
<td>https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierportal</td>
<td>email</td>
</tr>
</tbody>
</table>
<p>No.1: 商品の検索
<img src="file:///home/yusuke/record/image-7.png" alt="alt text"></p>
<p>No.2: ログイン画面
<img src="file:///home/yusuke/record/image-47.png" alt="alt text"></p>
<p>No.3 業者用のログイン画面
<img src="file:///home/yusuke/record/image-48.png" alt="alt text"></p>
<p>3.脆弱性発生状況</p>
<p>No.1の場合について説明する。
パラメータsearchqueryに対して、「searchquery=1000'」と入力した結果、DB関係のSQL Syntax errorが表示されたため、SQLインジェクションがあると判断した。</p>
<ul>
<li>HTTPリクエストメッセージ</li>
</ul>
<p><img src="file:///home/yusuke/record/image-8.png" alt="alt text"></p>
<ul>
<li>HTTPレスポンスメッセージ</li>
</ul>
<p><img src="file:///home/yusuke/record/image-9.png" alt="alt text"></p>
<ul>
<li>表示されるエラーメッセージ</li>
</ul>
<p><img src="file:///home/yusuke/record/image-10.png" alt="alt text"></p>
<p>4.想定される脅威
データベースに保存されている情報の漏洩、改ざん、消去や認証回避による不正ログインの恐れがある。</p>
<p>5.対応策
SQLの組み立てにプレースホルダーを用いて、バインド処理により値を割り当てる処理を推奨する。</p>
<h3 id="%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%A4%E3%83%B3%E3%82%B8%E3%82%A7%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3cwe-78">コマンドインジェクション(CWE-78)</h3>
<p>1.リスク評価 高</p>
<p>2.発見箇所</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>パラメータ</th>
</tr>
</thead>
<tbody>
<tr>
<td>https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierportal</td>
<td>viewfilename</td>
</tr>
</tbody>
</table>
<p>業者向けページのbadsite内価格ファイルの閲覧画面
<img src="file:///home/yusuke/record/image-12.png" alt="alt text"></p>
<p>3.脆弱性発生状況</p>
<p>パラメーター「viewfilename」に<code>../../../../../../../bin/sleep 20|</code>と入力して「Go」ボタンで実行した際にレスポンスが20秒遅れて返ってくる。</p>
<p><img src="file:///home/yusuke/record/image-13.png" alt="alt text"></p>
<p><img src="file:///home/yusuke/record/image-14.png" alt="alt text"></p>
<p>4.想定される脅威
サーバ内ファイルの閲覧、改ざん、削除や不正なシステム操作をされる恐れがある。</p>
<p>5.対応策
設計段階でOSコマンド呼び出しを使わない実装方法を選択する、シェル呼び出し機能のある関数の利用を避けるといった対策がある。
シェルを起動できる言語機能を利用する場合には、保険的な対策として、引数を構成する全ての変数に対してチェックを行い、あらかじめ許可した処理のみを実行するようにする。</p>
<p>##　クロスサイト・スクリプティング
1.リスク評価 中
2.発見箇所</p>
<table>
<thead>
<tr>
<th>No.</th>
<th>URL</th>
<th>パラメータ名</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>https://www.badstore.net/cgi-bin/badstore.cgi</td>
<td>searchquery</td>
</tr>
<tr>
<td>2</td>
<td>https://www.badstore.net/cgi-bin/badstore.cgi?action=myaccount</td>
<td>fullname</td>
</tr>
<tr>
<td>3</td>
<td>https://www.badstore.net/cgi-bin/badstore.cgi?action=guestbook</td>
<td>name</td>
</tr>
</tbody>
</table>
<p>No.1 商品の検索
<img src="file:///home/yusuke/record/image-7.png" alt="alt text"></p>
<p>No.2 アカウント情報の更新画面
<img src="file:///home/yusuke/record/image-52.png" alt="alt text"></p>
<p>No.3 フォーム送信画面
<img src="file:///home/yusuke/record/image-53.png" alt="alt text"></p>
<p>3.脆弱性発生状況</p>
<p>No.1の場合について説明する。
パラメータ「search_query」に<code>1000&lt;script&gt;alert(1)&lt;/script&gt;</code>と入力した際にエスケープされずに入力したスクリプトが作動した。</p>
<p>作動したスクリプト
<img src="file:///home/yusuke/record/image-54.png" alt="alt text"></p>
<ul>
<li>
<p>HTTPリスエストメッセージ
<img src="file:///home/yusuke/record/image-15.png" alt="alt text"></p>
</li>
<li>
<p>HTTPレスポンスメッセージ(一部)
<img src="file:///home/yusuke/record/image-16.png" alt="alt text"></p>
</li>
</ul>
<p>4.想定される脅威
本サイト上に偽のページが表示される、ブラウザが保存しているCookieを取得される等の可能性がある。</p>
<p>5.対応策
ウェブページに出力するするすべての要素に対して、エスケープ処理を施す。
URLを出力する際にはhttp, httpsで始まるURLのみを許可する、<code>&lt;script&gt;...&lt;/script&gt;</code>要素の内容を動的に生成しない等の対策をとる必要がある。</p>
<p>参考情報:</p>
<ul>
<li>エスケープ処理の実装例</li>
</ul>
<pre class="hljs"><code><div>&lt;?php
// エスケープ処理関数
function escape_html($input) {
    return htmlspecialchars($input, ENT_QUOTES, 'UTF-8');
}

// エスケープ処理を施した文字列
$unsafe_html = &quot;&lt;script&gt;alert('Hello, world!');&lt;/script&gt;&quot;;
$safe_html = escape_html($unsafe_html);

// 安全に表示される
echo &quot;&lt;div&gt;&quot; . $safe_html . &quot;&lt;/div&gt;&quot;;
?&gt;
</div></code></pre>
<h2 id="%E3%83%91%E3%82%B9%E3%83%88%E3%83%A9%E3%83%90%E3%83%BC%E3%82%B5%E3%83%AB">パストラバーサル</h2>
<p>1.リスク評価
2。発見箇所
https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierportal
<img src="file:///home/yusuke/record/image-35.png" alt="alt text">
3.脆弱性発生状況
パラメータ「viewfilename」に<code>../../../../../../../../../etc/hosts</code>と入力すると、サーバ内の/etc/hostsファイルが表示されてしまう
4.想定される脅威
hostsファイルの情報が外部に漏洩したり、改ざんや削除をされてしまう可能性がある。
5.対応策
外部からのパラメータでウェブサーバ内のファイル名を直接指定する実装を避ける。
ファイルを開く際は、固定のディレクトリを指定し、かつファイル名にディレクトリ名が含まれないようにする。</p>
<h3 id="%E3%82%AF%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B8%E3%83%A3%E3%83%83%E3%82%AD%E3%83%B3%E3%82%B0">クリックジャッキング</h3>
<p>1.リスク評価</p>
<p>2.発見箇所　http://www.badstore.net/cgi-bin/badstore.cgi?action=submitpayment
<img src="file:///home/yusuke/record/image-34.png" alt="alt text"></p>
<p>3.脆弱性発生状況
決済の確定処理の直前画面において、レスポンスヘッダにX-Frame-Optionsヘッダフィールドが存在しない。</p>
<p>4.想定される脅威
クリックじゃっキング攻撃により、クレジットカードの番号を盗み取られる危険性がある。</p>
<p>5.対応策
レスポンスヘッダにX-Frame-Optionsヘッダを出力するよう設定を行う。
X-Frame-Optionsヘッダフィールドは、コンテンツがiframeタグなどで他のサイトに埋め込まれないことを保証しており、
クリックジャッキング攻撃を防いでいる。</p>
<p>参考情報
PHPの場合のX-Frame-OptionsでSAMEIRIGIN(同一オリジンの場合のみiframeで表示)を設定する記述
<code>header('X-Frame-Options: SAMEORIGIN');</code></p>
<h3 id="%E8%AA%8D%E8%A8%BC">認証</h3>
<h4 id="%E3%83%AD%E3%82%B0%E3%82%A2%E3%82%A6%E3%83%88%E6%A9%9F%E8%83%BD%E3%81%AE%E4%B8%8D%E5%82%99%E3%82%84%E6%9C%AA%E5%AE%9F%E8%A3%85">ログアウト機能の不備や未実装</h4>
<p>1.リスク評価</p>
<p>2.発見箇所
すべてのページ</p>
<p>3.脆弱性発生状況
ログアウト機能が存在せず、手動で消去しない限りcookieが残る。</p>
<p>4.想定される脅威
共有PCを使っている場合や離席中のパソコンを勝手に使用される場合に、ログインしたままのアプリケーションがあれば、勝手に使われてなりすましをされてしまう恐れがある。</p>
<p>5.対応策
セッションタイムアウト時間を短くする。ログアウト機能の実装をする。</p>
<h4 id="%E9%81%8E%E5%BA%A6%E3%81%AA%E8%AA%8D%E8%A8%BC%E8%A9%A6%E8%A1%8C%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%AF%BE%E7%AD%96%E4%B8%8D%E5%82%99%E3%82%84%E6%9C%AA%E5%AE%9F%E8%A3%85">過度な認証試行に対する対策不備や未実装</h4>
<p>1.リスク評価</p>
<p>2.発見箇所
https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister
<img src="file:///home/yusuke/record/image-36.png" alt="alt text"></p>
<p>3.脆弱性発生状況
同じユーザー名でパスワードを連続で10回間違った場合でも、アカウントがロックされない。</p>
<!-- (4, 5 徳丸本参考) -->
<p>4.想定される脅威
ブルートフォース攻撃や辞書攻撃によって、繰り返し試行を行うことで不正なログインが行われてしまう。</p>
<p>5.対応策
10回を目安に、パスワードを連続して間違えた場合にはアカウントをロックする。
その後は次のようなルールでアカウントの再有効化を行う</p>
<ul>
<li>30分が経過した際に、自動的に再有効化する</li>
<li>何らかの方法で本人確認が行われた後に再有効化する</li>
</ul>
<h4 id="%E8%84%86%E5%BC%B1%E3%81%AA%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC">脆弱なパスワードポリシー</h4>
<p>1.リスク評価</p>
<p>2.発生個所
https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister
アカウントの登録画面
<img src="file:///home/yusuke/record/image-37.png" alt="alt text">
3.脆弱性発生状況
パスワードを登録する際に数字のみ(例:0000)のような脆弱なパスワードが登録できてしまう。</p>
<p>4．想定される脅威
パスワードが推測しやすいために、不正にログインされてしまう恐れがある。</p>
<p>5.対応策
パスワードを設定する際に、8桁以上で数値と英小大文字を含むといった、パスワードポリシーを定める。</p>
<h4 id="%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%83%AA%E3%82%BB%E3%83%83%E3%83%88%E3%81%AE%E4%B8%8D%E5%82%99">パスワードリセットの不備</h4>
<p>1.リスク評価</p>
<p>2.発生個所　
アカウントの再設定画面
https://www.badstore.net/cgi-bin/badstore.cgi?action=myaccount
<img src="file:///home/yusuke/record/image-46.png" alt="alt text">
<img src="file:///home/yusuke/record/image-45.png" alt="alt text"></p>
<p>3.脆弱性発生状況
パスワードリセットの際に、ユーザー本人のみが受け取れる連絡先に再設定方法が通知されるのではなく、画面上にWelcomeという再設定されたパスワードが表示され、そのままこのパスワードを利用することができる。
なお、パスワードの変更の際には、毎回、新しいパスワードとして「Welcome」という文字列が表示される。</p>
<p>4．想定される脅威
新しく発行されたパスワード「Welcome」をそのままユーザーが使用し続けた場合、攻撃者は容易にパスワードを推測できてしまう。</p>
<p>5.対応策
パスワードの変更のみができる仮パスワードをメールで利用者に送信する運用にする。</p>
<h3 id="%E8%AA%8D%E5%8F%AF%E5%88%B6%E5%BE%A1%E3%81%AE%E4%B8%8D%E5%82%99cwe-264">認可制御の不備(CWE-264)</h3>
<p>1.リスク評価　高
2.発見箇所</p>
<table>
<thead>
<tr>
<th>No</th>
<th>URL</th>
<th>パラメータ</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister</td>
<td>role</td>
</tr>
<tr>
<td>2</td>
<td>https://www.badstore.net/cgi-bin/badstore.cgi?action=supplierportal</td>
<td>action</td>
</tr>
<tr>
<td>3</td>
<td>https://www.badstore.net/cgi-bin/badstore.cgi?action=admin</td>
<td>action</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>アカウントの登録画面(No.1)
<img src="file:///home/yusuke/record/image-19.png" alt="alt text"></p>
</li>
<li>
<p>Supplier, Admin権限が必要な画面(No.2)
<img src="file:///home/yusuke/record/image-38.png" alt="alt text"></p>
</li>
<li>
<p>Admin権限が必要な画面(No.3)
<img src="file:///home/yusuke/record/image-49.png" alt="alt text"></p>
</li>
</ul>
<p>3.脆弱性発生状況</p>
<p>NO.1の場合
新しいユーザーを作成する際に、権限を示すパラメーター「role」をUからA, Sに書き換えることで、一般ユーザーに対して、サプライヤー権限や管理者権限を付与することができる。その結果、一般ユーザーではアクセスすることのできない情報や機能が閲覧、操作できてしまう。</p>
<ul>
<li>roleをUからAに書き換え
<img src="file:///home/yusuke/record/image-20.png" alt="alt text"></li>
</ul>
<p>No.2, No.3の場合
サプライヤー権限,admin権限が必要なページに対して、そのページのURLを指定することで、認証していない状態でアクセスできてしまう</p>
<p>4.想定される脅威
一般ユーザーが本来閲覧することのできないページを閲覧、編集することで、重要なデータの漏洩、改ざんの恐れがある。</p>
<p>5.対応策
権限の情報をセッション変数に保持することで書き換えを防ぐとともに、処理や表示の直前に権限の確認をするようにする。</p>
<h3 id="%E3%82%AF%E3%83%AD%E3%82%B9%E3%82%B5%E3%82%A4%E3%83%88%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%AA">クロスサイトリクエストフォージェリ</h3>
<p>1.リスク評価　中
2.発見箇所
https://www.badstore.net/cgi-bin/badstore.cgi?action=myaccount
<img src="file:///home/yusuke/record/image-21.png" alt="alt text">
3.脆弱性発生状況
ログイン中にアカウント情報を更新する際に
リクエストヘッダに以下の情報が含まれておらず、</p>
<pre class="hljs"><code><div>A: 利用者のパスワード
B: CSRF対策トークン
C: セッションID
D: CAPTCHA
</div></code></pre>
<p>かつ、Refererヘッダを変更しても更新処理ができてしまう。</p>
<p>元のHTTPリクエストヘッダ
<img src="file:///home/yusuke/record/image-24.png" alt="alt text">
Refererヘッダを削除
<img src="file:///home/yusuke/record/image-25.png" alt="alt text"> 更新できてしまう
<img src="file:///home/yusuke/record/image-26.png" alt="alt text"></p>
<p>4.想定される脅威
ログイン後の利用者のみが利用可能なサービスや編集可能な情報が悪用される恐れがある。</p>
<p>5.対応策
Refererヘッダがない場合や適切なURLが指定されていない場合はエラーを返すという方式にすることでCSRF攻撃を対策することができるが、
より確実な対策として、登録画面や決済画面ではトークンを埋め込む、パスワードを再入力させるという対策がある。</p>
<h2 id="%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%81%AE%E4%B8%8D%E5%82%99">セッション管理の不備</h2>
<h3 id="cookie%E3%81%AEhttponly%E5%B1%9E%E6%80%A7%E6%9C%AA%E8%A8%AD%E5%AE%9A">CookieのHttpOnly属性未設定</h3>
<p>1.リスク評価
2.発見箇所
https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister
<img src="file:///home/yusuke/record/image-27.png" alt="alt text"></p>
<p>3.脆弱性発生状況
ログイン時のレスポンスヘッダにあるSet-CookieヘッダーフィールドにHttpOnly属性が付与されていない
<img src="file:///home/yusuke/record/image-39.png" alt="alt text"></p>
<p>4.想定される脅威
Javascriptを使用してクッキーの値にアクセスされることで、セッションハイジャック攻撃等のリスクがある。</p>
<p>5.対応策
HttpOnly属性を使用して、Javascriptからのアクセスを防ぐ。</p>
<p>例えば、PHPではphp.iniに以下を設定する</p>
<p><code>session.cookie_httponly = on</code></p>
<h3 id="%E6%8E%A8%E6%B8%AC%E5%8F%AF%E8%83%BD%E3%81%AA%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3id">推測可能なセッションID</h3>
<p>1.リスク評価</p>
<p>2.発見箇所
https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister
<img src="file:///home/yusuke/record/image-27.png" alt="alt text"></p>
<p>3.脆弱性発生状況</p>
<p>ログイン時に発行されるセッションIDが、各ユーザーに対して固定されている。
また、セッションIDをエンコードした結果、次の法則をもとにセッションIDが生成されていることが分かった。</p>
<pre class="hljs"><code><div>(ユーザーのセッションID) = [Email Adress]:[Password]のMD5:[Fullname] : role
</div></code></pre>
<p>上から順に、元のセッションID, セッションIDをURLでデコードした結果、さらにBASE64でデコードした結果。
<img src="file:///home/yusuke/record/image-28.png" alt="alt text"></p>
<p>4.想定される脅威
セッションIDが推測できることで、セッションハイジャックが可能になる。</p>
<p>5.対応策
セッションIDを生成する際には、自作のセッション管理機構を自作するのではなく、アプリケーション開発ツールが備えているセッション管理機構を使用する。</p>
<h2 id="%E5%85%AC%E9%96%8B%E4%B8%8D%E8%A6%81%E3%81%AA%E6%A9%9F%E8%83%BD%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AE%E5%AD%98%E5%9C%A8">公開不要な機能、ディレクトリの存在</h2>
<p>https://www.badstore.net/cgi-bin/badstore.cgi?action=cartadd</p>
<p>http://www.badstore.net/ws/</p>
<ul>
<li>No.1
以下の画像のように、一つもカートに入っていない状態で注文ボタン(Place Order)を押すと、
ipアドレスが公開されたページへ飛んでしまう</li>
</ul>
<p><img src="file:///home/yusuke/record/image-32.png" alt="alt text"></p>
<p><img src="file:///home/yusuke/record/image-33.png" alt="alt text"></p>
<p>ホーム画面のこちらのリンクから
<img src="file:///home/yusuke/record/image-30.png" alt="alt text"></p>
<p>http://www.badstore.net/ws/ に飛ぶと、
削除予定のファイル一覧を見ることができてしまう。</p>
<pre class="hljs"><code><div>print &quot;\nNotice:  Usage of this client is deprecated and will be removed from the server in the next year.  Our security team wants everyone to connect to the service through the WSDL and not directly anymore.\n\n&quot;;
</div></code></pre>
<p>とあるように、来年には削除予定のファイルが閲覧できてしまう。</p>
<h2 id="%E6%83%85%E5%A0%B1%E6%BC%8F%E6%B4%A9">情報漏洩</h2>
<h3 id="%E7%94%BB%E9%9D%A2%E8%A1%A8%E7%A4%BA%E4%B8%8A%E3%81%AE%E3%83%9E%E3%82%B9%E3%82%AF%E4%B8%8D%E5%82%99">画面表示上のマスク不備</h3>
<p>1.リスク評価
2.発見箇所
https://www.badstore.net/cgi-bin/badstore.cgi?action=submitpayment
https://www.badstore.net/cgi-bin/badstore.cgi?action=viewprevious</p>
<p>No.1 商品の決済画面
<img src="file:///home/yusuke/record/image-51.png" alt="alt text">
No.2 購入履歴の画面
<img src="file:///home/yusuke/record/image-50.png" alt="alt text">
3.脆弱性発生状況
クレジットカードのキャッシュ番号がマスクされていない</p>
<h3 id="%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%81%AE%E3%83%9E%E3%82%B9%E3%82%AF%E4%B8%8D%E5%82%99">パスワードフィールドのマスク不備</h3>
<p>1.リスク評価
2.発見箇所
https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister
ログイン画面
<img src="file:///home/yusuke/record/image-40.png" alt="alt text">
3.脆弱性発生状況
ログイン画面でのパスワードの入力がマスクされていない</p>
<p>(4,5 徳丸本p.487参照)
4.想定される脅威
ショルダーハックにより、入力中にパスワードを盗み見されるリスクがある。
5.対応策
type属性がpasswordのinput属性を使い、入力されたパスワードが画面上に表示されないようにする。</p>
<h3 id="https%E5%88%A9%E7%94%A8%E6%99%82%E3%81%AEcookie%E3%81%AEsecure%E5%B1%9E%E6%80%A7%E6%9C%AA%E8%A8%AD%E5%AE%9A">HTTPS利用時のCookieのSecure属性未設定</h3>
<p>1.リスク評価
2.発見箇所
https://www.badstore.net/cgi-bin/badstore.cgi?action=loginregister
ログイン、登録画面
<img src="file:///home/yusuke/record/image-42.png" alt="alt text">
3.脆弱性発生状況
Httpsの利用時にCookieのSecure属性(SSL/TLSを併用したHTTPS通信でしかCookieのやり取りをしないようにする設定)が設定されていない</p>
<ul>
<li>登録、ログイン時にサーバによって発行されるCookie
<img src="file:///home/yusuke/record/image-31.png" alt="alt text"></li>
</ul>
<p>4.想定される脅威
アプリケーションがHTTPSを使用していても、Secure属性がついていないCookieは平文で送られてしまう場合があり、盗聴される可能性がある。</p>
<p>5.対応策
CookieにSecure属性を設定する。
例えば、PHPの場合はphp.iniに次のように設定することで、CookieにSecure属性をつけることができる</p>
<p><code>session.cookie_secure = on</code></p>
<h3 id="https%E3%81%AE%E4%B8%8D%E5%82%99">HTTPSの不備</h3>
<p>No.1</p>
<p>3.脆弱性発生状況
決済画面のURL https://www.badstore.net/cgi-bin/badstore.cgi?action=submitpayment
を https://www.badstore.net/cgi-bin/badstore.cgi?action=submitpayment と書き換えることで、HTTPでのアクセスが可能になってしまう。</p>
<p>4.想定される脅威
攻撃者によってURLが改ざんされることで、HTTPSではなくHTTPで通信をすることで、クレジットカードの番号やパスワードが攻撃者に奪われてしまう。</p>
<p>5.対応策
参考:https://www.idcf.jp/rentalserver/aossl/operation/unify-access/</p>
<p>301転送により、HTTPのページにアクセスがあった場合はHTTPSのページにリダイレクトするようにする</p>
<p>以下のように.htaccessファイルを設置することで301転送の設定ができる。</p>
<pre class="hljs"><code><div>Options +FollowSymLinks
RewriteEngine on
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://(ドメイン名)/$1 [R=301,L]
</div></code></pre>
<h2 id="%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AB%E3%82%88%E3%82%8B%E6%83%85%E5%A0%B1%E6%BC%8F%E3%81%88%E3%81%84cwe-209">エラーメッセージによる情報漏えい(CWE-209)</h2>
<p>1.リスク評価</p>
<p>2.発見箇所
http://www.badstore.net/cgi-bin/badstore.cgi
<img src="file:///home/yusuke/record/image-43.png" alt="alt text"></p>
<p>3.脆弱性発生状況
searchqueyパラメータに、データベースのItemNum欄に存在しない番号(例えば-1)を入力すると次のようなエラーメッセージが画面上に出力される
<img src="file:///home/yusuke/record/image-44.png" alt="alt text"></p>
<p>(4, 5参考 https://softwarenote.info/p3207/)
4.想定される脅威
エラーメッセージから、検索に使用しているSQL文が判明してしまう。それによって、SQLインジェクションなどのセキュリティのリスクがある。</p>
<p>5.対応策
利用者に見せるエラーメッセージと開発者が見るデバッグ情報を明確に区別する</p>
<p>例えば、PHPではphp.iniで次のような設定をする</p>
<pre class="hljs"><code><div>display_errors = Off # エラーの画面出力
log_errors = On # エラーのログ出力
</div></code></pre>
<h3 id="%E3%83%A1%E3%83%A2">メモ</h3>
<p>例えばSQLインジェクションが複数回発生している場合は次のように書けばいいみたい
<img src="file:///home/yusuke/record/image-29.png" alt="alt text">
参考になりそうな資料</p>
<p>脆弱性診断のサンプル
https://web-scan.jp/wp-content/uploads/2021/07/report-sample.pdf</p>
<p>https://www.valtes-mt.co.jp/pdf/sample_report.pdf</p>
<p>後で参照がしやすいように、なるべく参考にした情報を書いておく
(IPAの安全な~のときは書かなくていい、基本的にこの資料を参考にしているので)</p>

</body>
</html>
